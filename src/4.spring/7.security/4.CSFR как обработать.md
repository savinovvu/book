**CSRF (Cross-Site Request Forgery)** — это атака, при которой злоумышленник заставляет браузер пользователя выполнять нежелательные действия в веб-приложении, где пользователь аутентифицирован. Spring Security предоставляет встроенные механизмы защиты от CSRF.

### Как Spring Security обрабатывает CSRF?
1. **CSRF-токен по умолчанию**  
   Spring Security автоматически включает защиту от CSRF для stateful-приложений (с сессиями). Для каждого HTTP-запроса, изменяющего состояние (POST, PUT, DELETE), генерируется уникальный CSRF-токен, который:
    - Сохраняется в сессии.
    - Добавляется в HTML-формы как скрытое поле (`<input type="hidden" name="_csrf" value="токен"/>`).
    - Проверяется на сервере при получении запроса.

2. **Интеграция с формами (например, Thymeleaf)**  
   В шаблонизаторах токен автоматически вставляется в формы:
   ```html
   <form action="/update" method="post">
       <input type="hidden" name="_csrf" th:value="${_csrf.token}"/>
       <!-- остальные поля -->
   </form>
   ```

3. **Для REST API (stateless)**  
   Если приложение не использует сессии (например, аутентификация через JWT), CSRF-защиту **можно отключить**, так как атака CSRF актуальна только для сценариев, где браузер автоматически отправляет учетные данные (например, куки сессии). Пример конфигурации:
   ```java
   @Configuration
   @EnableWebSecurity
   public class SecurityConfig {
       @Bean
       public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
           http
               .csrf(csrf -> csrf.disable()) // Отключаем CSRF для stateless API
               .authorizeHttpRequests(auth -> auth.anyRequest().authenticated())
               .sessionManagement(session -> session.sessionCreationPolicy(SessionCreationPolicy.STATELESS));
           return http.build();
       }
   }
   ```

4. **Кастомизация CSRF-токена**  
   Можно изменить способ хранения и передачи токена:
   ```java
   http.csrf(csrf -> csrf
       .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse()) // Токен в куках
   );
   ```

### Ключевые моменты для Senior-разработчика:
- **Глубокая настройка токенов**: Реализация кастомного `CsrfTokenRepository` для хранения токенов в базе данных или распределенном кеше.
- **Сочетание с CORS**: CSRF-токены критичны при работе с кросс-доменными запросами. Неправильная настройка CORS может обойти CSRF-защиту.
- **Тестирование защиты**: Использование инструментов вроде OWASP ZAP для проверки уязвимостей.
- **Микросервисная архитектура**: В системах с API-гейтвеем токены могут передаваться через заголовки (например, `X-XSRF-TOKEN`).

### Когда отключать CSRF?
- **Stateless-приложения** с аутентификацией через JWT/Bearer-токены.
- **SOAP-сервисы** или другие небраузерные клиенты.
- **Публичные API**, не использующие сессии.

Важно: Отключайте CSRF **только** если вы уверены, что риски отсутствуют. Для веб-интерфейсов с сессиями защита обязательна.