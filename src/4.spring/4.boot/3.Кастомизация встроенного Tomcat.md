Кастомизация встроенного Tomcat в Spring Boot выполняется двумя основными способами:

## 1. Через `application.properties`/`application.yml`

Базовые настройки можно задать через конфигурационные файлы:

**application.properties:**
```properties
# Основные настройки сервера
server.port=8080
server.servlet.context-path=/myapp

# Настройки Tomcat
server.tomcat.max-connections=2000
server.tomcat.max-threads=150
server.tomcat.min-spare-threads=10
server.tomcat.connection-timeout=5000
server.tomcat.accept-count=100

# SSL настройки
server.ssl.key-store=classpath:keystore.p12
server.ssl.key-store-password=secret
server.ssl.key-store-type=PKCS12
```

**application.yml:**
```yaml
server:
  port: 8080
  servlet:
    context-path: /myapp
  tomcat:
    max-connections: 2000
    max-threads: 150
    min-spare-threads: 10
    connection-timeout: 5000
    accept-count: 100
```

## 2. Через `WebServerFactoryCustomizer` (рекомендуется для сложной кастомизации)

```java
import org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory;
import org.springframework.boot.web.server.WebServerFactoryCustomizer;
import org.springframework.stereotype.Component;

@Component
public class TomcatCustomizer implements WebServerFactoryCustomizer<TomcatServletWebServerFactory> {

    @Override
    public void customize(TomcatServletWebServerFactory factory) {
        // Настройка порта и контекста
        factory.setPort(8080);
        factory.setContextPath("/myapp");
        
        // Кастомизация connector
        factory.addConnectorCustomizers(connector -> {
            connector.setMaxConnections(2000);
            connector.setMaxThreads(150);
            connector.setConnectionTimeout(5000);
        });
        
        // Добавление кастомных клапанов (Valves)
        factory.addEngineValves(new CustomTomcatValve());
        
        // Настройка SSL
        factory.addConnectorCustomizers(connector -> {
            connector.setScheme("https");
            connector.setSecure(true);
            connector.setProperty("SSLEnabled", "true");
        });
    }
}
```

## 3. Расширенная кастомизация через `TomcatServletWebServerFactory`

```java
@Configuration
public class TomcatConfig {
    
    @Bean
    public TomcatServletWebServerFactory tomcatFactory() {
        TomcatServletWebServerFactory factory = new TomcatServletWebServerFactory();
        
        factory.addConnectorCustomizers(connector -> {
            // Настройка HTTP/2
            connector.addUpgradeProtocol(new Http2Protocol());
            
            // Дополнительные настройки
            connector.setAttribute("maxKeepAliveRequests", 100);
        });
        
        // Добавление кастомного клапана для логирования
        factory.addEngineValves(new RequestLoggingValve());
        
        return factory;
    }
}
```

## 4. Кастомизация через `ServletWebServerFactory`

```java
@Bean
public ServletWebServerFactory servletContainer() {
    TomcatServletWebServerFactory tomcat = new TomcatServletWebServerFactory();
    
    tomcat.addConnectorCustomizers(connector -> {
        ProtocolHandler handler = connector.getProtocolHandler();
        if (handler instanceof Http11NioProtocol) {
            Http11NioProtocol protocol = (Http11NioProtocol) handler;
            protocol.setMaxConnections(2000);
            protocol.setMaxThreads(150);
            protocol.setConnectionTimeout(5000);
        }
    });
    
    return tomcat;
}
```

## Ключевые различия подходов:

| Подход | Преимущества | Недостатки |
|--------|--------------|------------|
| `application.properties` | Простота, быстрота настройки | Ограниченный функционал |
| `WebServerFactoryCustomizer` | Гибкость, доступ к низкоуровневым настройкам | Требует написания кода |
| `TomcatServletWebServerFactory` | Полный контроль над конфигурацией | Более сложная реализация |

## Дополнительные возможности:

```java
// Кастомный клапан для мониторинга
@Component
public class MonitoringValve extends ValveBase {
    @Override
    public void invoke(Request request, Response response) {
        long startTime = System.currentTimeMillis();
        try {
            getNext().invoke(request, response);
        } finally {
            long duration = System.currentTimeMillis() - startTime;
            // Логирование метрик
        }
    }
}
```

**Рекомендация Spring Senior:** Используйте `application.properties` для базовых настроек и `WebServerFactoryCustomizer` для сложной кастомизации, требующей программной логики.